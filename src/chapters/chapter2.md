# 第二章 - 率先躬行のサインポスト

Git とは何かという事や Git を使う理由について説明してきました。
ここから Git の操作方法をコマンドラインインタフェース (CLI) のコマンドと Fork というソフトウェアを使用して説明します。
なお CLI を使った説明は「Git 初心者への道 - お仕事で困らないレベルまでググっとします。[^2]」や「今日からはじめる GitHub 〜 初心者が Git をインストールして、プルリクできるようになるまでを解説[^3]」といったページを見て、なんとなくの雰囲気を掴むのが良いでしょう。

Fork は以下の URL からダウンロードできます。Fork は Windows と macOS に対応しています。
`https://git-fork.com/`

## Git によるバージョン管理を始める `git init`

`git init` や `git clone` は任意のディレクトリで Git によるバージョン管理を始めるためのコマンドです。
いわば未来ガジェット研究所でタイムリープマシンが作られた状態にするものです。

Fork を起動した後、メニューの File から Init New Repository を選びます。

![メニューのFileからInit New Repositoryを選択している図](https://i.gyazo.com/0194555935fde3f096354652bbd49567.png)

Init New Repository を選ぶと、ディレクトリを選択する画面になるのですでにあるディレクトリもしくは新たにディレクトリを作って、そのディレクトリを選びます。
その状態で「フォルダーを選択」を押すと、選択したディレクトリ（フォルダ）が Git のリポジトリとして使えるようになります。

![リポジトリが作られた状態](https://i.gyazo.com/4f06f842f2579b411fccec39a8bbe184.png)

## すでにあるリモートリポジトリを使ってバージョン管理を始める `git clone`

すでにあるリモートリポジトリを自分の PC 上へコピーし Git によるバージョン管理を始められるようにします。
その前に、リモートリポジトリについて少し説明をします。リモートリポジトリとは、自分の PC 以外にあるリポジトリの事を指します。
「自分の PC 以外にあるリポジトリ」ですが「インターネット上や誰かの PC 上にあるリポジトリ」を指します。
他の章で「ネットワーク上のリポジトリ」という言葉がありましたが、これは「リモートリポジトリ」と同じ意味です。

このリモートリポジトリを自分の PC 上にコピーするのがこれから説明する手順です。
これでたとえばラボメンなど、他の人と共同でタイムリープマシンを使って作業できる体制が整います。

Fork を起動した後、メニューの File から Clone を選ぶと次の画面になります。

![Forkでクローンするときの画面](https://i.gyazo.com/dc1a89b72a6dd0486a4a5e7c946d8f40.png)

ここでリポジトリの URL とクローン先のディレクトリを選択し Clone を押すと選択したディレクトリにリポジトリが置かれます。

## 作業内容を記録する `git commit`

作業した内容をリポジトリに記録します。例えるならば、Steins;Gate でストーリーを進めた後、セーブをするようなものです。

リポジトリ内にファイルを新しく作成した場合 Fork 上では Unstaged Changes という欄に表示されます。
ファイルがまだバージョン管理されてない事を示しています。

![ファイルがUnstaged Changesにある状態](https://i.gyazo.com/b547aee9bc275d48807c05e34bba57a1.png)

この状態で「Stage」ボタンを押すと Staged Changes という欄へファイルが移動します。
これでコミットするための準備が整うことになります。

![ファイルがStaged Changesへ移動した状態](https://i.gyazo.com/104c5dc7dc8010516112742013b8edfd.png)

ファイルを移動した状態で、画面の右下部にある「Enter commit subject」と書かれている場所に任意のメッセージを入力します。

![コミットメッセージを入力しているところ](https://i.gyazo.com/78d87e651f16232cf3993ec8dc85adea.png)

入力した後「Commit File」ボタンを押すと作業した内容がリポジトリに記録されます。

![コミットした後](https://i.gyazo.com/fa7fc133722fd2a5987620ad766d3a78.png)

なお右上のコミット一覧が表示されている場所に「master」という表記がありますが、これは「現時点でどのブランチにいるかを判別する情報」です。
つまり世界線の観測ができているということです。たとえるならばダイバージェンスメーターです。

## 作業内容を無かった事にする `git checkout -- <ファイル名>`

岡部は、ダルにメールを送信した後、秋葉原 UPX でタイムマシン理論についての講義を受けましたが、ディスカッションで紅莉栖に完全に論破されてしまいました。
岡部にとって、論破されたという事は無くしたい事象ですが Git であればそれができます。

方法としては、作業内容を無かった事にするファイルを右クリックで選択し「Discard changes」を選択します。

![作業内容を無かった事にする](https://i.gyazo.com/9466853e76869d34ccee44d5a7809a87.png)

変更を本当に破棄していいか確認画面が表示されるので「Discard」を押します。
これで紅莉栖に論破されたという事実は無くなりました。

## 作業内容の差分を見る

作業内容の差分を見ます。
例えるならば、まゆりが死んだ理由を前回死んだ理由と比較し、そこから試行錯誤するようなものです。

Fork では、特定の作業内容を選択する事で、その作業内容の一つ前の作業内容と比べてどのような変更をしたのか見る事ができます。

![Fork で作業内容の差分を見ている例](/assets/images/ch2/git-diff/source-tree/diff.jpg)

## ブランチの一覧を見たり、新たにブランチを作ったりする

ブランチの一覧を見たり、新たにブランチを作ったりします。「ブランチ」は例えるならば「世界線」となり、ブランチを作るという事は「世界線の観測」になります。
また、リポジトリには「HEAD」という「自分が今どのブランチ(世界線)にいるのか分かるファイル」があり、それはダイバージェンスメーターだと言えるでしょう。
では、ブランチを作る方法を説明していきます。なお、現在のブランチは「秋葉原が電気街となり、フェイリスのお父さんが生きている世界線」だとします。
「秋葉原が電気街となり、フェイリスのお父さんが生きている世界線」で鈴羽を引き止めるために、岡部が D メールを送信しました。ここまでの作業内容は以下のようになります。

![新たなブランチを作る前](/assets/images/ch2/git-branch/source-tree/before.jpg)

この状態から Fork もしくは GitHub for Windows (Mac) を使って「鈴羽を引き止めるために D メールを送信した後の世界線」というブランチを作ります。

Fork の画面上部にある「ブランチ」を押すとブランチ名を入力する画面が表示されます。この画面内の新規ブランチの項目に任意の名前を入力します。

![ブランチ名を決めているところ](/assets/images/ch2/git-branch/source-tree/name.jpg)

「ブランチを作成」を押すとブランチができた状態になり、かつ作ったブランチ(鈴羽を引き止めた世界線)に移動しています。世界線変動が起きました。

![ブランチを作った後](/assets/images/ch2/git-branch/source-tree/after.jpg)

## 作業内容をリセットする

作業内容を無かった事にします。例えるならば、タイムリープのようなものです。
「作業内容を無かった事にする」と似ていますが、違いとしては「すでにリポジトリに追加した作業内容も無かった事にできる」と「作業内容をリセットしたという事が履歴に残る」があります。
たとえば「作業内容を無かった事にする」はリーディング・シュタイナーが働かないので記憶から無くなってしまいます。しかし「作業内容をリセットする」はリーディング・シュタイナーが働くため記憶に残ります。このように例えれば分かりやすいと思います。
話を戻しますが「鈴羽を引き止めた世界線」でいくつか作業をした結果、履歴が以下のようになりました。最新の作業内容は「SERN の襲撃によりまゆりが死んでしまった…」となっています。

![鈴羽を引き止めた世界線でいくつか作業した後の状態](/assets/images/ch2/git-reset-before.jpg)

ここで最新の作業内容である「SERN の襲撃によりまゆりが死んでしまった…」という作業を無かった事にして、紅莉栖がタイムリープマシンを完成させたところにタイムリープします。
タイムリープするためには、戻したい作業内容の一つ前の作業内容を右クリックで選択し「このコミットまで "ブランチ名" を元に戻す」を選択します。

![git resetをおこなおうとしている状態](/assets/images/ch2/git-reset-right-click.jpg)

これで、作業内容から「SERN の襲撃によりまゆりが死んでしまった…」というのが消えました。

![git resetをした後の状態](/assets/images/ch2/git-reset-after.jpg)

## 作業内容を改変する

作業内容を改変します。例えるならば、タイムリープマシンを使って過去の作業をやり直す感じです。
電話レンジ(仮)を改造してタイムリープマシンができた後、萌郁やラウンダー達の襲撃もしくは他の要因により、まゆりが何度も死んでしまった状態の最新の作業内容ですが「ラウンダー追ってきて、まゆりが刺されて死んだ」となっています。

![まゆりが何度も死んでしまったときの作業内容](/assets/images/ch2/git-rebase/source-tree/message-edit-before.jpg)

## コミットメッセージを修正する

まず始めに、コミットメッセージを修正してみます。
先ほどの最新の作業内容を記録したコミットが「ラウンダー追ってきて」と、間に「が」が足りないメッセージになっています。これを修正するため、直したい対象の一つ前の作業内容を右クリックで選択し「"コミット番号" の子を対話形式でリベース」を選びます。

![対話形式でリベースを選択している状態](/assets/images/ch2/git-rebase/source-tree/message-edit-select.jpg)

すると対象となる作業内容が表示されます。そこでコミットメッセージを直したい作業内容を選び、画面下部の「Edit message」を押すと、コミットメッセージを編集する画面が表示されます。

![コミットメッセージを編集している状態](/assets/images/ch2/git-rebase/source-tree/message-edit-now.jpg)

任意のコミットメッセージを書いた後「OK」ボタンを押すとコミットメッセージが修正されます。

![コミットメッセージを編集し終えた状態](/assets/images/ch2/git-rebase/source-tree/message-edit-after.jpg)

## 複数の作業内容を一つにまとめる

次に、まゆりが死んだと書かれた複数の履歴を一つにまとめます。直したい対象の一つ前の作業内容を右クリックで選択し「"コミット番号" の子を対話形式でリベース」を選びます。

![git rebase squash するべく親となるコミットを選択している状態](/assets/images/ch2/git-rebase/source-tree/squash-right-click.jpg)

今回は四つの作業内容を対象としました。ここから作業内容をまとめるには「Squash with previous」を三回押します。「まとめる作業内容の数 - 一回 Squash with previous を押す」と覚えるといいかもしれません。

![git rebase squash しようとしている状態](/assets/images/ch2/git-rebase/source-tree/squash-before.jpg)

その後、まとめた作業内容のコミットメッセージを編集するために「Edit message」を押します。

![コミットをまとめた後コミットメッセージを編集している状態](/assets/images/ch2/git-rebase/source-tree/squash-message-edit.jpg)

これで、まゆりが死んだと書かれた複数の履歴がまとめられました。

![git rebase squashした状態](/assets/images/ch2/git-rebase/source-tree/squash-after.jpg)

## ブランチを移動する

現在のブランチから別のブランチへ移動します。例えるならば D メールを送った結果、世界線変動が起こった状態を、任意のタイミングで起こせるというものです。
Git のブランチは「世界線」です。D メールによる世界線変動は、世界の状況に影響を及ぼしてましたが、Git ではそういった副作用が無く世界線の移動ができます。

移動の方法は簡単です。
画面左端に表示されているブランチ一覧から、移動したいブランチの名前をダブルクリックする事により、ブランチを移動できます。
以下の図では「鈴羽を引き止めた世界線」から「萌郁が IBN 5100 を手に入れた世界線」へ移動しています。

![ブランチを移動した後](/assets/images/ch2/git-checkout.jpg)

## リモートリポジトリに作業内容を送る

自分がした作業内容を、リモートリポジトリに送ります。例えるならば、岡部が紅莉栖にまゆりを助けるべくあれこれしてきた事を共有する感じです。
今まで、岡部はまゆりを助けるために何度もタイムリープをおこなって奮闘してきましたが、その事を他のラボメンは知りません。
奮闘している事を知られないままタイムリープマシンを壊そうとしても、紅莉栖に止められるのはしかたないです。

なので、他のラボメン(今回の場合だと紅莉栖)に今まで岡部がしてきた作業内容を伝える必要があります。
画面上部の「プッシュ」を押します。初期設定では現在のブランチのみが選択されているので、その状態で「OK」を押します。

![git push 前](/assets/images/ch2/git-push-branch-select.jpg)

プッシュが終わり、作業内容の一覧に「origin/ブランチ名」という文字が表示されるようになりました。なお、「origin」というのは、リモートリポジトリの事を指しています。
作業内容をリモートリポジトリに送ったとともに、紅莉栖にも今までの作業内容が伝わりました。

![git push 後](/assets/images/ch2/git-push-after.jpg)

## リモートリポジトリの変更内容を自分の PC 上のリポジトリに取り込む

他人がした変更をリモートリポジトリから取得し、自分の PC 上のリポジトリに取り込みます。

リモートリポジトリでは、岡部以外にもラボメンが作業しています。
例えば紅莉栖を見てみると、岡部の様子がおかしいのでタイムリープしてきたのか聞いていたり、マイフォークが欲しいと言った事を記録していたりします。

その場合、自分の PC 上のリポジトリ(鈴羽を引き止めた世界線)に比べ、リモートリポジトリ(origin/鈴羽を引き止めた世界線)が二つ進んでいます。

![紅莉栖が作業している](/assets/images/ch2/git-pull-before.jpg)

ここで、画面上部の「プル」を押します。基本は表示された画面内の「OK」を押すだけで良いです。

![pull してくるブランチを選んでいる状態](/assets/images/ch2/git-pull-select.jpg)

「OK」を押す事により、自分とリモートのリポジトリの作業内容が同期します。

![自分の PC 上のリポジトリとリモートリポジトリの同期をとった](/assets/images/ch2/git-pull-after.jpg)

## 別のブランチでの作業内容を取り込む

別ブランチの作業内容を現在のブランチに取り込みます。例えるならば、世界線を収束させるための作業です。
「鈴羽を引き止めた世界線」というブランチで作業をした結果、鈴羽がタイムトラベルを失敗して「失敗した失敗した失敗した失敗した失敗した」と何度も書いた手紙を書き残し、自殺してしまいました。
その結果、岡部は天王寺裕吾から鈴羽が書いた手紙を受け取る事になります。

![鈴羽を引き止めた世界線でいくつか作業をした例](/assets/images/ch2/git-merge/source-tree/before.jpg)

それを無かった事にするため D メールを送り世界線を変動させて鈴羽を引き止めないようにします。その為には「秋葉原から萌えが消えた世界線」のブランチへ移動します。

![秋葉原から萌えが消えた世界線に移動した](/assets/images/ch2/git-merge/source-tree/branch-change.jpg)

移動した後は D メールを送った状態が最新の状態となっています。この状態から「鈴羽を引き止めた世界線」でしてきた作業を「秋葉原から萌えが消えた世界線」に統合します。
方法としては、統合したいブランチの名前を右クリックして「"統合するブランチ名" を "統合させたいブランチ名" へマージ」を選択します。

![マージ対象のブランチを選択している状態](/assets/images/ch2/git-merge/source-tree/select.jpg)

選択すると、確認メッセージが表示されるので「確認する」を押します。

![マージする際の確認メッセージ](/assets/images/ch2/git-merge/source-tree/confirm.jpg)

すると「秋葉原から萌えが消えた世界線」に「鈴羽を引き止めた世界線」でしてきた作業内容が統合された状態になります。

![マージした後の状態](/assets/images/ch2/git-merge/source-tree/uncommit.jpg)

ただし、まだコミットはされていないのでコミットをしておきます。ここではコミットメッセージを「尾行は中止前のメールは SERN の罠というメールを送信した」としています。

![マージした際のコミットメッセージを書いている状態](/assets/images/ch2/git-merge/source-tree/commit-message.jpg)

コミットが完了しました。このように D メールを送信する感覚で、ブランチ同士を統合する事ができます。

![マージが完了した状態](/assets/images/ch2/git-merge/source-tree/after.jpg)

[^1] https://git-fork.com/
[^2] https://gist.github.com/yatemmma/6486028
[^3] https://employment.en-japan.com/engineerhub/entry/2017/01/31/110000
