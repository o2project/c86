#!/bin/bash

declare parentDir=$(cd $(dirname $(cd $(dirname $0);pwd));pwd)

INPUT_FILES=`ls $parentDir/sources/docbook/**/*.xml`
OUTPUT_DIR=$(pwd)/sources/markdown

for input in $INPUT_FILES
do
    filename=`basename $input .xml`
    dirname=`dirname $input`
    chapter_dir=`basename $dirname`
    out_dir=$OUTPUT_DIR/$chapter_dir

    if [ ! -e {$out_dir} ]; then
        mkdir $out_dir
    fi

    pandoc -f docbook -t markdown_strict --wrap=none $dirname/$filename.xml -o $out_dir/$filename.md
done
